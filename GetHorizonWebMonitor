$infinite = $true
While ($infinite -eq $true){
$TargetDomain = ".youngtech.local"
$HorizonCSArray = @(
	'CS01'
	'CS02'
	'CS03'
)

$GetHorizonWebMonitor = {
        param($TargetDomain,$HorizonCS)
	$web = New-Object Net.WebClient
	$request = $null
	$URLtoCheck = "https://" + $HorizonCS + $TargetDomain + "/admin"
	[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
	try {
		$result = (Measure-Command { $request = Invoke-WebRequest -Uri $URLtoCheck -UseBasicParsing}).Milliseconds
	} catch {
		$result = $_
	}
	$returnObject = New-Object -TypeName PSObject -Property @{
		HorizonCS	= 	$HorizonCS
		ResponseTime 	=	$result
	}
	$returnObject
}

foreach($HorizonCS in $HorizonCSArray){
	Start-Job -ScriptBlock $GetHorizonWebMonitor -ArgumentList $TargetDomain,$HorizonCS
}

While (Get-Job -State "Running") {
    write-host -NoNewline "."
    start-sleep 1
}

$returnArray = Get-Job | Receive-Job #

Remove-Job *

cls

$returnArray | Select-Object HorizonCS,ResponseTime | Foreach {[PSCustomObject]$_} | Format-Table -AutoSize -Wrap

start-sleep 60
}
